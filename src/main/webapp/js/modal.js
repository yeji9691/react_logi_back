'use strict';
// O Customer, Item, to Î≥ÄÏàò
let jsonData;

let listGrid = document.querySelector('#listGrid');

let mpsGrid = document.querySelector('#mpsGrid');
let mrpGrid = document.querySelector("#mrpGrid");
let mrpGatheringGrid = document.querySelector("#mrpGatheringGrid");
let orderGrid = document.querySelector("#orderGrid");
let warehousingGrid = document.querySelector("#warehousingGrid");
let workOrderSimulationGrid = document.querySelector("#workOrderSimulationGrid");
let workSiteSituationGrid = document.querySelector("#workSiteSituationGrid");
let to;                      // Ï†ÑÎã¨ Î≥ÄÏàò
let transferVar = () => to;  // Ï†ÑÎã¨ Ìï®Ïàò
let isElement = []; 

// O Common GridOptions
const gridOptions = {
    defaultColDef: {editable: false},
    onGridReady: function (event) {
        event.api.sizeColumnsToFit();
    },
    onGridSizeChanged: function (event) {
        event.api.sizeColumnsToFit();
    },
    rowSelection: 'multiple',
};

// O Get ajax Data  FROM (TABLE) DETAIL_CODE
const getListData = (divisionCodeNo) => {
    let xhr = new XMLHttpRequest();
    xhr.open('POST',
        '/compinfo/codedetail2/list?method=findDetailCodeList&divisionCodeNo='+divisionCodeNo,
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            console.log("**********************");
            console.log(jsonData);
            if (jsonData.errorCode != 1) {
            	console.log('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
			setListModal();
        }
    };
};

// O Setting Customer MODAL Grid FROM ajax data 
/*    if (!isElement.includes(section)) {
        isElement.push(section);
    } else {
        return;
    } // ÏöîÏÜåÍ∞Ä ÏûàÏúºÎ©¥ ÎÇòÏò§Í∏∞!! */
const setListModal = () => {   

    let listGridOptions = gridOptions;
    listGridOptions.columnDefs = [
        {headerName: 'ÏÉÅÏÑ∏ÏΩîÎìúÎ≤àÌò∏', field: 'detailCode', width: 80, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÏÉÅÏÑ∏ÏΩîÎìúÏù¥Î¶Ñ', field: 'detailCodeName', width: 80, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÏÇ¨Ïö©Ïó¨Î∂Ä', field: 'codeUseCheck', width: 80, cellStyle: {'textAlign': 'center'}}];
    listGridOptions.onRowDoubleClicked = (event) => {
		console.log(event);
        console.log('event.data.detailCodeName:'+event.data);
        to = event.data;
        let closeList = document.querySelectorAll('.close');
        for (let value of closeList) {
            value.click();
        }

		let selectedRows=contractGridOptions.api.getSelectedNodes();
		console.log(selectedRows);
		if(selectedRows!=undefined){
			selectedRows.map(selectedData =>{
				selectedData.data.contractType=to.detailCode;
				selectedData.data.contractTypeName=to.detailCodeName;
			})
		}
		contractGridOptions.api.redrawRows(selectedRows);
    };
    console.log(listGrid);
	if(listGrid!=null){
		listGrid.innerHTML="";
    	new agGrid.Grid(listGrid, listGridOptions);
		listGridOptions.api.setRowData(jsonData.detailCodeList); 
	}
};
// O Get StandardUnitPrice
const getStandardUnitPrice = (itemCode, unit) => {
    console.log(itemCode);
    let xhr = new XMLHttpRequest();
    // BOX
    xhr.open('GET',
        `/logiinfo/item/standardunitprice?method=getStandardUnitPrice&itemCode=${itemCode}`,
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText
            jsonData = JSON.parse(txt);
            console.log(jsonData);
            document.querySelector("#unitPriceOfEstimateBox").value = jsonData.gridRowJson;
            if (jsonData.errorCode != 1) {
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
        }
    };
};
// jsonData.gridRowJson;
const setMpsModal = () => {
    let mpsGridOptions = gridOptions;
    mpsGridOptions.columnDefs = [
        {headerName: 'Ï£ºÏÉùÏÇ∞Í≥ÑÌöçÎ≤àÌò∏', field: 'mpsNo', width: 450, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Í≥ÑÌöçÍµ¨Î∂Ñ', field: 'mpsPlanClassification', width: 250, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÏùºÎ†®Î≤àÌò∏(ÏàòÏ£º/ÌåêÎß§)', field: 'no', width: 500, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÏàòÏ£ºÏÉÅÏÑ∏ÏùºÎ†®Î≤àÌò∏', field: 'contractDetailNo', cellStyle: {'textAlign': 'center'}, hide: true},
        {headerName: 'ÌåêÎß§Í≥ÑÌöçÏùºÎ†®Î≤àÌò∏', field: 'salesPlanNo', cellStyle: {'textAlign': 'center'}, hide: true},
        {headerName: 'ÌíàÎ™©ÏΩîÎìú', field: 'itemCode', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName', width: 450, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Îã®ÏúÑ', field: 'unitOfMps', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Í≥ÑÌöçÏùºÏûê', field: 'mpsPlanDate', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Í≥ÑÌöçÏàòÎüâ', field: 'mpsPlanAmount', cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÎÇ©Í∏∞Ïùº', field: 'dueDateOfMps', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÏòàÏ†ïÎßàÍ∞êÏùºÏûê', field: 'scheduledEndDate', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'MRP Ï†ÅÏö©ÏÉÅÌÉú', field: 'mrpApplyStatus', width: 350, cellStyle: {'textAlign': 'center'}, cellRenderer:(params) => {
                if (params.value == 'Y') {
                    params.node.selectable = false;
                  return params.value = "üü¢";
                }
                return '‚ùå';
            }},
        {headerName: 'ÎπÑÍ≥†', field: 'description', cellStyle: {'textAlign': 'center'}},
    ];
    mpsGridOptions.onGridReady = function () {
        for (let i = 0; i < jsonData.gridRowJson.length; i++) {
            jsonData.gridRowJson[i].no = jsonData.gridRowJson[i].mpsPlanClassification == "ÏàòÏ£ºÏÉÅÏÑ∏"
                ? jsonData.gridRowJson[i].contractDetailNo : jsonData.gridRowJson[i].salesPlanNo;
        }
        mpsGridOptions.api.setRowData(jsonData.gridRowJson);
    };

    new agGrid.Grid(mpsGrid, mpsGridOptions);
}
// O mps modal
const getMpsList = () => {
    let fromDate = document.querySelector("#fromDate");
    let toDate = document.querySelector("#toDate");
    let xhr = new XMLHttpRequest();
    xhr.open('GET', '/production/mps/list' +
        "?method=searchMpsInfo"
        + "&startDate=" + fromDate.value
        + "&endDate=" + toDate.value
        + "&includeMrpApply=includeMrpApply",  // mrpÏ†ÅÏö©Îêú Îç∞Ïù¥ÌÑ∞ÎèÑ Ìè¨Ìï® 
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            console.log(txt);
            jsonData = JSON.parse(txt);
            console.log(jsonData);
            if (jsonData.errorCode != 1) {
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
        }
    }
}
// O MRP SIMULATION
// o set Mrp modal
let mrpGridOptions;
const setMrpModal = () => {
    mrpGridOptions = gridOptions;
    mrpGridOptions.columnDefs = [
        {headerName: 'Ï£ºÏÉùÏÇ∞Í≥ÑÌöçÎ≤àÌò∏', field: 'mpsNo', width: 450, cellStyle: {'textAlign': 'center'}},
        {headerName: 'BOM Î≤àÌò∏', field: 'bomNo', width: 450, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÌíàÎ™©Íµ¨Î∂Ñ', field: 'itemClassification', width: 300, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©ÏΩîÎìú', field: 'itemCode', width: 300, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName', width: 500, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Î∞úÏ£º/ÏûëÏóÖÏßÄÏãúÏãúÏûëÍ∏∞Ìïú', field: 'orderDate', width: 450, cellStyle: {'textAlign': 'center'}, editable: true},
        {
            headerName: 'Î∞úÏ£º/ÏûëÏóÖÏßÄÏãúÏôÑÎ£åÍ∏∞Ìïú',
            field: 'requiredDate',
            width: 450,
            cellStyle: {'textAlign': 'center'},
            editable: true
        },
        {headerName: 'Í≥ÑÌöçÏàòÎüâ', field: 'planAmount', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÎàÑÏ†ÅÏÜêÏã§Ïú®', field: 'totalLossRate', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Í≥ÑÏÇ∞ÏàòÎüâ', field: 'caculatedAmount', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌïÑÏöîÏàòÎüâ', field: 'requiredAmount', width: 350, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Îã®ÏúÑ', field: 'unitOfMrp', width: 350, cellStyle: {'textAlign': 'center'}},
    ];
    new agGrid.Grid(mrpGrid, mrpGridOptions);
}
// o get Mrp data
let mpsRowNodes;
let mpsNoList;
const getMrpList = (mpsRowNode) => {
    mrpGridOptions.api.setRowData([]);
    let xhr = new XMLHttpRequest();
	mpsRowNodes=mpsRowNode;
	mpsNoList = [];
	console.log(mpsRowNode);
	for(let i=0;i<mpsRowNode.length;i++){
		mpsNoList.push(mpsRowNode[i].data.mpsNo);
	}
    console.log(mpsNoList);
    xhr.open('GET', '/production/mrp/open' +
        "?method=openMrp"
        + "&mpsNoList=" + encodeURI(JSON.stringify(mpsNoList)),
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            console.log(jsonData);
            mrpGridOptions.api.updateRowData({add: jsonData.gridRowJson});
            if (jsonData.errorCode != 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
        }
    }
}
// do registerMrp
const registerMrp = (mrpDate) => {  // mrpÎì±Î°ù (ÏÜåÏöîÎüâ Ï†ÑÍ∞ú ÏùºÏûê)
    let xhr = new XMLHttpRequest();
    let batchList = JSON.stringify(jsonData.gridRowJson);  // Î™®Ïùò Ï†ÑÍ∞ú Ìï†Îïå, MRP Î™®ÏùòÏ†ÑÍ∞ú Ï†ïÎ≥¥ Îã¥ÍπÄ  "[{},{}..]"
	console.log(mpsNoList);
    xhr.open('POST', '/production/mrp' +
        "?method=registerMrp"
        + "&batchList=" + encodeURI(JSON.stringify(mpsNoList))
        + "&mrpRegisterDate=" + mrpDate,
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
			console.log(txt);
			console.log("ÏúÑÎäî txtÏùò Í∞í");
			console.log(txt.result);
			console.log("ÏúÑÎäî txt.resultÏùò Í∞í");
			console.log(txt.result[0].firstMrpNo);
			console.log("ÏúÑÎäî txt.result.firstMrpNoÏùò Í∞í");
            let resultMsg =
                `< ÏÜåÏöîÎüâÏ†ÑÍ∞ú  => ÏÜåÏöîÎüâÏ∑®Ìï© Îì±Î°ù ÎÇ¥Ïó≠ ><br>`
                + (`ÏÜåÏöîÎüâÏ∑®Ìï© ÏùºÎ†®Î≤àÌò∏ : <br>`
                + txt.result[0].firstMrpNo + ` Î∂ÄÌÑ∞ ` + txt.result[0].lastMrpNo + ` ÍπåÏßÄ <br>
                     Ï¥ù ` + (txt.result[0].length-1) + `Í±¥ Îì±Î°ù ÏôÑÎ£å.<br>`) + `<br>
                     ÏúÑÏôÄ Í∞ôÏù¥ ÏûëÏóÖÏù¥ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`;
            console.log(mpsRowNodes);
			for(let i=0;i<mpsRowNodes.length;i++){
            	mpsRowNodes[i].setDataValue("mrpApplyStatus", 'Y'); 
			}
            if (jsonData.errorCode != 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            } else {
                Swal.fire("ÏÑ±Í≥µ", resultMsg, "success");
                $('#mrpModal').modal('hide');
            }
        }
    }
}
// O MRP GATHERING
// o set MrpGathering
let mrpGatheringGridOptions;
const setMrpGatheringModal = () => {
    mrpGatheringGridOptions = gridOptions;
    mrpGatheringGridOptions.columnDefs = [
        {headerName: "Íµ¨Îß§ Î∞è ÏÉùÏÇ∞Ïó¨Î∂Ä", field: "orderOrProductionStatus", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÌíàÎ™©ÏΩîÎìú", field: "itemCode", cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Îã®ÏúÑ', field: 'unitOfMrpGathering', cellStyle: {'textAlign': 'center'}},
        {
            headerName: 'Î∞úÏ£º/ÏûëÏóÖÏßÄÏãúÏãúÏûëÍ∏∞Ìïú',
            field: 'claimDate',
            cellStyle: {'textAlign': 'center'},
            cellRenderer: function (params) {
                if (params.value == null) {
                    params.value = "";
                }
                return 'üìÖ ' + params.value;
            }
        },
        {
            headerName: 'Î∞úÏ£º/ÏûëÏóÖÏßÄÏãúÏôÑÎ£åÍ∏∞Ìïú',
            field: 'dueDate',
            cellStyle: {'textAlign': 'center'},
            cellRenderer: function (params) {
                if (params.value == null) {
                    params.value = "";
                }
                return 'üìÖ ' + params.value;
            }
        },
        {headerName: 'ÌïÑÏöîÏàòÎüâ', field: 'necessaryAmount', cellStyle: {'textAlign': 'center'}}
    ];
    mrpGatheringGridOptions.getRowStyle = (param) => {
        if (param.data.orderOrProductionStatus != "Íµ¨Îß§") {
            return {'font-weight': 'bold', background: '#b1b5cc'};
        }
    }
    new agGrid.Grid(mrpGatheringGrid, mrpGatheringGridOptions);
}
// o get MrpGathering Data
const getMrpGatheringModal = (mrpNoList) => {  // ÏÜåÏöîÎüâÏ∑®Ìï©Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏïÑÏôÄ Í∑∏Î¶¨ÎìúÏóê ÏÑ∏ÌåÖ 
    mrpGatheringGridOptions.api.setRowData([]);
    let xhr = new XMLHttpRequest();
    mrpNoList = JSON.stringify(mrpNoList);
    xhr.open('GET', '/production/mrp/gathering-list' +
        "?method=getMrpGatheringList"
        + "&mrpNoList=" + encodeURI(mrpNoList),  // ÏÜåÏöîÎüâÏ∑®Ìï©ÎêòÏßÄ ÏïäÏùÄ mrpÎ¶¨Ïä§Ìä∏Î•º Î≥¥ÎÇ¥Í≥†, Í∑∏Îì§ÏùÑ Ï∑®Ìï©ÌïúÎã§. 
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            // todo ... Ïôú mrpGatheringNo, mrpGatheringStatus, mrpTOList ÎÑòÏñ¥Ïò§ÎäîÍ±∞ÏßÄ?
            for (let objcet of jsonData.gridRowJson) {   // jsonÏùò Ìï¥Îãπ ÌÇ§Î•º ÏÇ≠Ï†úÌïúÎã§?
                delete objcet.mrpGatheringNo;
                delete objcet.mrpGatheringStatus;
                delete objcet.mrpTOList;
            }
            console.log(jsonData);
            mrpGatheringGridOptions.api.updateRowData({add: jsonData.gridRowJson});
            if (jsonData.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
        }
    }
}
const registerMrpGathering = (mrpGatheringDate, mrpNoList, mrpNoAndItemCodeList) => {
    let xhr = new XMLHttpRequest();
    //let mrpGatheringList = JSON.stringify(jsonData.gridRowJson); // ÏÜåÏöîÎüâÏ∑®Ìï©Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞ 
    mrpNoList = JSON.stringify(mrpNoList); // ÏÜåÏöîÎüâÏ∑®Ìï©ÎêòÏßÄ ÏïäÏùÄ mrpno Î™©Î°ù
    mrpNoAndItemCodeList = JSON.stringify(mrpNoAndItemCodeList); // ÏÜåÏöîÎüâÏ∑®Ìï©ÎêòÏßÄ ÏïäÏùÄ mrpno : itemCode
    xhr.open('POST', '/production/mrp/gathering' +
        "?method=registerMrpGathering"
        + "&mrpGatheringRegisterDate=" + mrpGatheringDate
        + "&mrpNoList=" + encodeURI(mrpNoList)
        + "&mrpNoAndItemCodeList=" + encodeURI(mrpNoAndItemCodeList),
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
			let t1 = JSON.stringify(txt);
	console.log("Ïó¨Í∏∞::"+t1.result);
	console.log(txt);
            let resultMsg =
                "< ÏÜåÏöîÎüâÏ†ÑÍ∞ú => ÏÜåÏöîÎüâÏ∑®Ìï© Îì±Î°ù ÎÇ¥Ïó≠ ><br/>"
                + ( ( txt.result.INSERT.length != 0 ) ?
                "ÏÜåÏöîÎüâÏ∑®Ìï© ÏùºÎ†®Î≤àÌò∏ : " + txt.result.firstMrpGatheringNo +" Î∂ÄÌÑ∞ </br>"
                + txt.result.lastMrpGatheringNo  +" ÍπåÏßÄ </br>"
                + txt.result.INSERT.length + " Í±¥ Îì±Î°ù ÏôÑÎ£å. </br>"
                + "ÏÜåÏöîÎüâÏ†ÑÍ∞ú ÏùºÎ†®Î≤àÌò∏ : " + txt.result.changeMrpGatheringStatus
                + "</br> Ïùò ÏÜåÏöîÎüâÏ∑®Ìï© Ï†ÅÏö©ÏÉÅÌÉú  \"Y\" Î°ú Î≥ÄÍ≤Ω ÏôÑÎ£å.": "ÏóÜÏùå" ) + "</br>"
                + "ÏúÑÏôÄ Í∞ôÏù¥ ÏûëÏóÖÏù¥ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.";
            mrpGatheringGridOptions.api.setRowData([]);
            if (txt.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            } else {
                Swal.fire("ÏÑ±Í≥µ", resultMsg, "success");
            }
        }
    }
}
// O OrderDialog
let orderGridOptions;
const setOrderModal = () => {
    orderGridOptions = gridOptions;
    orderGridOptions.columnDefs = [
        {headerName: "ÌíàÎ™©ÏΩîÎìú", field: "itemCode", cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Îã®ÏúÑ', field: 'unitOfMrp', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Ï¥ùÌïÑÏöîÎüâ', field: 'requiredAmount',cellStyle:{'textAlign': 'center'}},
        {headerName: 'ÏÇ¨Ïö©Í∞ÄÎä•Ïû¨Í≥†Îüâ', field: 'stockAmount', cellStyle: {'textAlign': 'center'},},
        {headerName: 'Ïã§Ï†úÎ∞úÏ£ºÌïÑÏöîÎüâ', field: 'calculatedRequiredAmount', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Îã®Í∞Ä', field: 'standardUnitPrice', cellStyle: {'textAlign': 'center'}},
        {headerName: 'Ìï©Í≥ÑÍ∏àÏï°', field: 'sumPrice', cellStyle: {'textAlign': 'center'},valueFormatter: currencyFormatter},
    ];
	function currencyFormatter(params) {
        return formatNumber(params.value)+' ‚Ç©';
    }
	function formatNumber(number) {
        // this puts commas into the number eg 1000 goes to 1,000,
        // i pulled this from stack overflow, i have no idea how it works
        return Math.floor(number).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
    }
    new agGrid.Grid(orderGrid, orderGridOptions);
}
const getOrderModal = (mrpGatheringList) => {
    let xhr = new XMLHttpRequest();
    mrpGatheringList = JSON.stringify(mrpGatheringList);
    xhr.open('GET', '/purchase/order/dialog' +
        "?method=openOrderDialog"
        + "&mrpGatheringNoList=" + encodeURI(mrpGatheringList),
        true)
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
            orderGridOptions.api.setRowData([]);
            if (txt.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
            orderGridOptions.api.updateRowData({add: txt.gridRowJson});
        }
    }
}


// O Warehousing
let warehousingGridOptions;
const setWarehousingModal = () => {
    warehousingGridOptions = gridOptions;
    warehousingGridOptions.columnDefs = [
        {headerName: "Î∞úÏ£ºÎ≤àÌò∏", field: "orderNo", suppressSizeToFit: true, headerCheckboxSelection: true,
            headerCheckboxSelectionFilteredOnly: true,
            checkboxSelection: true},
        {headerName: "Î∞úÏ£ºÎÇ†Ïßú", field: "orderDate", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏÉÅÌÉú", field: "orderInfoStatus", cellStyle: {'textAlign': 'center'}},
        {headerName: 'Î∞úÏ£ºÍµ¨Î∂Ñ', field: 'orderSort', cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©ÏΩîÎìú', field: 'itemCode', cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName',cellStyle:{'textAlign': 'center'}},
        {headerName: 'ÏàòÎüâ', field: 'orderAmount', cellStyle: {'textAlign': 'center'},},
        {headerName: 'Í≤ÄÏÇ¨ÏÉÅÌÉú', field: 'inspectionStatus', cellStyle: {'textAlign': 'center'},cellRenderer: function (params) {
            if (params.value == "Y") {
                return params.value =  "üü¢" ;
            }
            return '‚úñÔ∏è' ; 
        }},
    ];
    warehousingGridOptions.getRowNodeId = (data) => {
        return data.orderNo;
    };
    new agGrid.Grid(warehousingGrid, warehousingGridOptions);
}
const getWarehousingModal = () => {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', '/purchase/order/delivery' +
        "?method=searchOrderInfoListOnDelivery",
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            warehousingGridOptions.api.setRowData([]);
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
			console.log(txt);
            if (txt.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
            warehousingGridOptions.api.updateRowData({add: txt.gridRowJson});
        }
    }
}
// O WorkOrderSimulationModal
// o set WorkOrderSimulationModal
let workOrderSimulationGridOptions;
const setWorkOrderSimulationModal = () => {
    workOrderSimulationGridOptions = gridOptions;
    workOrderSimulationGridOptions.columnDefs = [
        
       // {headerName: "Ï£ºÏÉùÏÇ∞Í≥ÑÌöçÎ≤àÌò∏", width: 500,field: "mpsNo", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏÜåÏöîÎüâÏ∑®Ìï©Î≤àÌò∏", width: 500,field: "mrpGatheringNo",cellStyle:{'textAlign': 'center'}},
		{headerName: "ÏÜåÏöîÎüâÏ†ÑÍ∞úÎ≤àÌò∏", width: 500, field: "mrpNo", cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î∂ÑÎ•ò', field: 'itemClassification', width: 300,cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©ÏΩîÎìú', field: 'itemCode', width: 400, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName',width: 550,cellStyle:{'textAlign': 'center'}},
        {headerName: 'Îã®ÏúÑ', field: 'unitOfMrp', width: 300,cellStyle: {'textAlign': 'center'},},
        {headerName: 'Ïû¨Í≥†Îüâ(Ìà¨ÏûÖÏòàÏ†ïÏû¨Í≥†)', field: 'inputAmount', width: 450,cellStyle: {'textAlign': 'center'},},
        {headerName: 'Ïû¨Í≥†ÏÜåÏöî/Ï†úÏûëÏàòÎüâ', field: 'requiredAmount', width: 400,cellStyle: {'textAlign': 'center'},},
        {headerName: 'Ïû¨Í≥†Îüâ(Ïû¨Í≥†ÏÜåÏöîÏù¥ÌõÑ)', field: 'stockAfterWork', width: 500,cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÏûëÏóÖÏßÄÏãúÍ∏∞Ìïú', field: 'orderDate', width: 400,cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÏûëÏóÖÏôÑÎ£åÍ∏∞Ìïú', field: 'requiredDate', width: 400,cellStyle: {'textAlign': 'center'},},
    ];
    workOrderSimulationGridOptions.getRowNodeId = (data) => {
        return data.requiredDate;
    };
    new agGrid.Grid(workOrderSimulationGrid, workOrderSimulationGridOptions);
}
// o get WorkOrderSimulationModal
const getWorkOrderSimulationModal = (mrpGatheringNoList,mrpNoList) => {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', '/quality/workorder/dialog'
        + "?method=showWorkOrderDialog"
        + "&mrpGatheringNoList=" + encodeURI(JSON.stringify(mrpGatheringNoList))
		+ "&mrpNoList=" + encodeURI(JSON.stringify(mrpNoList)),
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
	        workOrderSimulationGridOptions.api.setRowData([]);
            if (txt.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
            console.log('txt');
            console.log(txt);
            console.log(txt.result);
            workOrderSimulationGridOptions.api.updateRowData({add: txt.result});
        }
    }
}
// o set Worksite
let workSiteSimulationGridOptions;
const setWorkSiteModal = () => {
    workSiteSimulationGridOptions = gridOptions;
    workSiteSimulationGridOptions.columnDefs = [
        {headerName: "ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏",  field: "workOrderNo", cellStyle: {'textAlign': 'center'}},
        //{headerName: "ÏÜåÏöîÎüâÏ†ÑÍ∞úÎ≤àÌò∏",  field: "mrpNo", cellStyle: {'textAlign': 'center'}},
       // {headerName: "Ï£ºÏÉùÏÇ∞Í≥ÑÌöçÎ≤àÌò∏",  field: "mpsNo", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏûëÏóÖÏû•Î™Ö",  field: "workSieteName", cellStyle: {'textAlign': 'center'}},
        {headerName: "Ï†úÏûëÌíàÎ™©Î∂ÑÎ•ò",  field: "wdItem", cellStyle: {'textAlign': 'center'}},
        {headerName: "Ï†úÏûëÌíàÎ™©ÏΩîÎìú",  field: "parentItemCode", cellStyle: {'textAlign': 'center'}},
        {headerName: "Ï†úÏûëÌíàÎ™©Î™Ö",  field: "parentItemName", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏûëÏóÖÌíàÎ™©Î∂ÑÎ•ò",  field: "itemClassIfication", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏûëÏóÖÌíàÎ™©ÏΩîÎìú",  field: "itemCode", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏûëÏóÖÌíàÎ™©Î™Ö",  field: "itemName", cellStyle: {'textAlign': 'center'}},
        {headerName: "ÏûëÏóÖÎüâ",  field: "requiredAmount", cellStyle: {'textAlign': 'center'}},
    ];
    new agGrid.Grid(workSiteSituationGrid, workSiteSimulationGridOptions);
}
const getWorkSiteModal = (workSiteCourse, workOrderNo, itemClassIfication) => { // Í≤ÄÏÇ¨Ìï≠Î™©,ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏,ÌíàÎ™©Î∂ÑÎ•ò
    console.log(workSiteCourse);
    console.log(workOrderNo);
    console.log(itemClassIfication);

    let xhr = new XMLHttpRequest();
    xhr.open('GET', '/quality/worksite/situation'
        + "?method=showWorkSiteSituation"
        + "&workSiteCourse=" + workSiteCourse
        + "&workOrderNo=" + workOrderNo
        + "&itemClassIfication=" + encodeURI(itemClassIfication),
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            txt = JSON.parse(txt);
            console.log('test');
            console.log(txt.gridRowJson);
            workSiteSimulationGridOptions.api.setRowData([]);
            if (txt.errorCode < 0) {
                Swal.fire({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return;
            }
            workSiteSimulationGridOptions.api.setRowData(txt.gridRowJson);
        }
    }
}

const getOSListData = (condition) => {
    let xhr = new XMLHttpRequest();
    xhr.open('GET',
        '/compinfo/customer/list'
 		+ "?method=searchCustomerList"
        + "&searchCondition=" + condition,
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            console.log(jsonData);
            if (jsonData.errorCode != 1) {
            	console.log('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: 'error',
                });
                return jsonData.gridRowJson;
            }
        }
    };
};
// O 68_ÏïÑÏõÉÏÜåÏã± Setting Customer MODAL Grid FROM ajax data

const setOSListModal = () => {   
    let listGridOptions = gridOptions;
	listGridOptions.columnDefs = [
        {headerName: 'Í±∞ÎûòÏ≤òÏΩîÎìú', field: 'customerCode', width: 80, cellStyle: {'textAlign': 'center'}},
        {headerName: 'Í±∞ÎûòÏ≤òÏù¥Î¶Ñ', field: 'customerName', width: 80, cellStyle: {'textAlign': 'center'}},
        {headerName: 'ÌíàÎ™©ÏΩîÎìú', field: 'itemCode', width: 80, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÌíàÎ™©Î™Ö', field: 'itemName', width: 80, cellStyle: {'textAlign': 'center'},},
        {headerName: 'ÌíàÎ™©Íµ∞', field: 'itemGroupName', width: 80, cellStyle: {'textAlign': 'center'}}];
    listGridOptions.onRowDoubleClicked = (event) => {
        console.log('event.data.detailCodeName:'+event.data);
        to = event.data;
		/*console.log(to);*/
        let closeAll = document.querySelectorAll('.close');
        for (let closeBT of closeAll) {
            closeBT.click();
        }
		let customerTxt = document.getElementById('customerTxt'); 		//Ï∂îÍ∞ÄÎêú Î∂ÄÎ∂Ñ(ÌÖçÏä§Ìä∏Î∞ïÏä§ ÏÑ§Ï†ï)
		let cusHiddenBox = document.getElementById("customerCode");
		let itemTxt = document.getElementById('itemTxt');
		let itemHiddenBox = document.getElementById('itemCode');
		if($("#listModalTitle").text() == "CUSTOMER BY ITEM_GROUP"){
			customerTxt.value = to.customerName;
			cusHiddenBox.value = to.customerCode;
			itemTxt.value = to.itemName;
			itemHiddenBox.value = to.itemCode;
		}else{
			customerTxt.value = to.customerName;
			cusHiddenBox.value = to.customerCode;
			itemTxt.value = to.itemName;
			itemHiddenBox.value = to.itemCode;
		}
    }; 
	listGridOptions.onGridReady = function () {
    	listGridOptions.api.setRowData(jsonData.gridRowJson); 
    };
    listGrid.innerHTML="";
	new agGrid.Grid(listGrid, listGridOptions);   
};

const getLatLng = (wareHouseCodeNo) => {
   
    let xhr = new XMLHttpRequest();
    xhr.open('GET',
        '/compinfo/code/latlng?method=findLatLngList&wareHouseCodeNo='+wareHouseCodeNo,
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            console.log("**********************");
            console.log("jsonData");
            console.log(jsonData);
            console.log("jsonData.detailCodeList");
            console.log(jsonData.detailCodeList);          
              let lat = Number(jsonData.detailCodeList[0].latitude);
              let lng = Number(jsonData.detailCodeList[0].longitude);
              
              console.log(lat);
              console.log(lng);
              
              interceptor(lat,lng);
            if (jsonData.errorCode != 1) {
               console.log('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: "error",
                });
                return;
            }else{
            
         }   
         
        }
    };
};

const getItemImage = (itemGroupCodeNo) => {
   
    let xhr = new XMLHttpRequest();
    xhr.open('GET',
        '/compinfo/code/itemimage?method=findDetailImageList&itemGroupCodeNo='+itemGroupCodeNo,
        true);
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.send();
    xhr.onreadystatechange = () => {
        if (xhr.readyState == 4 && xhr.status == 200) {
            let txt = xhr.responseText;
            jsonData = JSON.parse(txt);
            console.log("**********************");
            console.log("jsonData");
            console.log(jsonData);
            console.log("jsonData.detailCodeList");
            console.log(jsonData.detailCodeList);
            console.log("jsonData.detailCodeList.image");
            console.log(jsonData.detailCodeList[0].image);
            let imgRoute = jsonData.detailCodeList[0].image;
            let www = jsonData.detailCodeList[0].explanation;
            if (jsonData.errorCode != 1) {
               console.log('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                swal({
                    text: 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÎìúÎ¶¨ÎäîÎç∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    icon: "error",
                });
                return;
            }else{
             Swal.fire({
                 text: www,
                 imageUrl: imgRoute,
               });
         }   
        }
    };
};